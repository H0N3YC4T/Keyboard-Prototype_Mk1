/*
 * Copyright (c) 2020 The ZMK Contributors
 *
 * SPDX-License-Identifier: MIT
 */

#include <behaviors.dtsi>
#include <dt-bindings/zmk/backlight.h>
#include <dt-bindings/zmk/bt.h>
#include <dt-bindings/zmk/ext_power.h>
#include <dt-bindings/zmk/keys.h>
#include <dt-bindings/zmk/pointing.h>

#define BASE 0
#define LOWER 1
#define RAISE 2
#define ADJUST 3
#define SETTINGS 4
#define ARROWS 5
#define MOUSE 6
#define GAMES 7

/ {
    // Activate ADJUST layer by pressing raise and lower

    conditional_layers {
        compatible = "zmk,conditional-layers";

        condition_settings {
            if-layers = <1 2>;
            then-layer = <3>;
        };
    };

    behaviors {
        hold_esc: hold_esc {
            compatible = "zmk,behavior-hold-tap";
            label = "HOLD_ESC";
            bindings = <&kp>, <&kp>;

            #binding-cells = <2>;
            flavor = "tap-preferred";
            tapping-term-ms = <80>;
        };
    };

    keymap {
        compatible = "zmk,keymap";

        default_layer {
            display-name = "Base";
            bindings = <
&hold_esc ESCAPE GRAVE  &kp N1  &kp N2  &kp N3    &kp N4    &kp N5                        &kp N6  &kp N7    &kp N8     &kp N9   &kp N0    &kp MINUS
&kp TAB                 &kp Q   &kp W   &kp E     &kp R     &kp T                         &kp Y   &kp U     &kp I      &kp O    &kp P     &kp DELETE
&kp LCTRL               &kp A   &kp S   &kp D     &kp F     &kp G                         &kp H   &kp J     &kp K      &kp L    &kp SEMI  &kp SQT
&kp LSHFT               &kp Z   &kp X   &kp C     &kp V     &kp B   &tog 4     &tog 5     &kp N   &kp M     &kp COMMA  &kp DOT  &kp FSLH  &kp RSHFT
                                        &kp LALT  &kp LGUI  &mo 1   &kp ENTER  &kp SPACE  &mo 2   &kp BSPC  &kp RGUI
            >;

            sensor-bindings = <&inc_dec_kp UP DOWN>, <&inc_dec_kp RIGHT LEFT>;
        };

        layer_lower {
            display-name = "Lower";
            bindings = <
&kp ESC  &trans          &trans     &trans     &trans     &trans                                 &trans             &trans            &trans          &trans            &trans        &none
&trans   &kp LC(LS(N4))  &none      &none      &none      &none                                  &none              &kp HOME          &kp UP_ARROW    &kp END           &none         &kp DELETE
&trans   &kp LC(A)       &kp LC(S)  &kp LC(D)  &kp LC(F)  &kp LC(G)                              &none              &kp LEFT_ARROW    &kp DOWN_ARROW  &kp RIGHT_ARROW   &none         &none
&trans   &kp LC(Z)       &kp LC(X)  &kp LC(C)  &kp LC(V)  &kp LEFT_BRACKET  &kp LG(TAB)  &none   &kp RIGHT_BRACKET  &kp LA(LEFT_WIN)  &kp LG(Z)       &kp LS(LEFT_WIN)  &kp LEFT_WIN  &trans
                                    &trans     &trans     &trans            &trans       &trans  &trans             &trans            &trans
            >;

            sensor-bindings =
                <&inc_dec_kp C_AC_ZOOM_IN C_AC_ZOOM_OUT>,
                <&inc_dec_kp LC(Y) LC(Z)>;
        };

        layer_upper {
            display-name = "Raise";
            bindings = <
&trans  &kp F1        &kp F2        &kp F3        &kp F4        &kp F5                                                 &kp F6                 &kp F7    &kp F8           &kp F9     &kp F10        &kp F11
&trans  &kp NUMBER_1  &kp NUMBER_2  &kp NUMBER_3  &kp NUMBER_4  &kp N5                                                 &kp NUMBER_6           &kp N7    &kp N8           &kp N9     &kp N0         &kp F12
&trans  &kp EXCL      &kp AT        &kp HASH      &kp DOLLAR    &kp PRCNT                                              &kp CARET              &kp AMPS  &kp KP_MULTIPLY  &kp LPAR   &kp RPAR       &kp PIPE
&trans  &kp EQUAL     &kp MINUS     &kp PLUS      &none         &kp LEFT_PARENTHESIS  &kp LESS_THAN  &kp GREATER_THAN  &kp RIGHT_PARENTHESIS  &none     &kp SEMI         &kp COLON  &kp BACKSLASH  &kp RIGHT_SHIFT
                                    &trans        &trans        &trans                &trans         &trans            &trans                 &trans    &trans
            >;

            sensor-bindings =
                <&inc_dec_kp K_SCROLL_UP K_SCROLL_DOWN>,
                <&inc_dec_kp C_AL_NEXT_TASK C_AL_PREVIOUS_TASK>;
        };

        layer_settings {
            display-name = "Settings";
            bindings = <
&bt BT_CLR         &bt BT_SEL 0  &bt BT_SEL 1  &bt BT_SEL 2  &bt BT_SEL 3  &bt BT_SEL 4                                &tog 4          &tog 5             &tog 6  &none  &none  &none
&sys_reset         &bl BL_INC    &none         &none         &none         &kp RS(RC(ESCAPE))                          &none           &none              &none   &none  &none  &none
&ext_power EP_TOG  &bl BL_TOG    &none         &none         &none         &kp RG(E)                                   &kp LG(LC(D))   &kp LG(LC(RIGHT))  &none   &none  &none  &none
&studio_unlock     &bl BL_DEC    &none         &none         &none         &none               &kp K_MUTE  &kp K_MUTE  &kp LG(LC(F4))  &kp LG(LC(LEFT))   &none   &none  &none  &none
                                               &trans        &trans        &trans              &trans      &trans      &trans          &trans             &trans
            >;

            sensor-bindings =
                <&inc_dec_kp C_VOLUME_UP C_VOLUME_DOWN>,
                <&inc_dec_kp C_VOLUME_UP C_VOLUME_DOWN>;
        };

        layer_arrows {
            display-name = "Arrows";
            bindings = <
&kp ESCAPE        &none             &none           &none             &none     &none                        &none  &none           &none           &none            &none  &tog 4
&kp TAB           &kp HOME          &kp UP_ARROW    &kp END           &none     &none                        &none  &kp HOME        &kp UP_ARROW    &kp END          &none  &kp TAB
&kp LEFT_CONTROL  &kp LEFT_ARROW    &kp DOWN_ARROW  &kp RIGHT_ARROW   &none     &none                        &none  &kp LEFT_ARROW  &kp DOWN_ARROW  &kp RIGHT_ARROW  &none  &kp LEFT_CONTROL
&kp LEFT_SHIFT    &kp LA(LEFT_WIN)  &kp LG(Z)       &kp LS(LEFT_WIN)  &none     &none  &none      &none      &none  &kp LEFT_ARROW  &kp DOWN_ARROW  &kp RIGHT_ARROW  &none  &kp LEFT_SHIFT
                                                    &kp LEFT_ALT      &kp LWIN  &none  &kp ENTER  &kp ENTER  &none  &kp BACKSPACE   &kp LWIN
            >;

            sensor-bindings = <&inc_dec_kp UP DOWN>, <&inc_dec_kp UP DOWN>;
        };

        layer_mouse {
            display-name = "Mouse";
            bindings = <
&kp ESCAPE        &kp LS(TAB)       &kp ENTER       &kp TAB           &none         &none                      &none  &none          &none     &none  &none  &tog 5
&kp TAB           &mkp MB1          &mmv MOVE_UP    &mkp MB2          &none         &none                      &none  &none          &none     &none  &none  &kp TAB
&kp LEFT_CONTROL  &mmv MOVE_LEFT    &mmv MOVE_DOWN  &mmv MOVE_RIGHT   &none         &none                      &none  &none          &none     &none  &none  &kp LEFT_CONTROL
&kp LEFT_SHIFT    &kp LA(LEFT_WIN)  &kp LG(Z)       &kp LS(LEFT_WIN)  &kp LEFT_WIN  &none  &none     &none     &none  &none          &none     &none  &none  &kp LEFT_SHIFT
                                                    &kp LEFT_ALT      &kp LWIN      &none  &mkp MB1  &mkp MB1  &none  &kp BACKSPACE  &kp LWIN
            >;
        };

        layer_gaming {
            display-name = "Gaming";
            bindings = <
&kp ESCAPE  &kp N1  &kp N2  &kp N3  &kp N4            &kp N5                              &kp N6       &kp N7  &kp N8     &kp N9   &kp N0    &tog 6
&kp TAB     &kp Q   &kp W   &kp E   &kp R             &kp T                               &kp Y        &kp U   &kp I      &kp O    &kp P     &kp BSLH
&kp LSHFT   &kp A   &kp S   &kp D   &kp F             &kp G                               &kp H        &kp J   &kp K      &kp L    &kp RET   &kp RET
&kp LCTRL   &kp Z   &kp X   &kp C   &kp V             &kp B         &none      &none      &kp N        &kp M   &kp COMMA  &kp DOT  &kp FSLH  &kp RSHFT
                            &none   &kp LEFT_CONTROL  &kp LEFT_ALT  &kp SPACE  &kp ENTER  &kp LA(TAB)  &trans  &trans
            >;

            sensor-bindings =
                <&inc_dec_kp K_VOLUME_DOWN K_VOLUME_DOWN>,
                <&inc_dec_kp K_NEXT K_PREV>;
        };
    };
};
